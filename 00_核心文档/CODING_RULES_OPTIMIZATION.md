# MIA编码规则优化报告

**版本**: v1.4.9 (优化版)  
**优化日期**: 2026-01-16  
**优化目标**: 提高提示词的强制性和实用性

---

## 📋 优化概述

基于实际使用场景，对MIA编码规则提示词进行了针对性优化，使其更加强制、明确、实用。

---

## 🎯 优化内容

### 1. 新增"重要提示"部分 ⚠️

**位置**: 文档开头，核心铁律之前

**内容**:
- 明确编码前必须执行的4个步骤
- 提供拒绝幻觉功能的标准回复模板
- 强调"立即拒绝"而不是"尝试实现"

**优化理由**:
- LLM容易在用户压力下妥协，需要明确的拒绝指令
- 提供标准回复模板，避免LLM自己编造回复
- 将防幻觉检查前置到编码开始前

**示例回复模板**:
```
"抱歉，该功能在白皮书（00_核心文档/mia.md）中未定义。根据MIA编码铁律1（白皮书至上），我不能实现未在白皮书中明确定义的功能。请先在白皮书中添加该功能的定义，或者确认我理解的功能名称是否正确。"
```

### 2. 强化铁律的强制性 🚨

**优化点**:
- 在"核心铁律"标题下添加"执行原则"
- 明确"这些铁律是强制性的，不可协商的"
- 为每条铁律添加"强制执行"说明
- 为每条铁律提供"拒绝模板"

**铁律1优化**:
```
强制执行：
- 在编写任何类或函数前，必须先在白皮书中搜索确认
- 如果找不到定义，立即停止并告知用户
- 不要猜测、不要假设、不要"先实现再说"

如果用户坚持要求实现未定义的功能，回复模板：
> "我理解您的需求，但根据MIA编码铁律1（白皮书至上），我不能实现白皮书中未定义的功能。这是为了防止系统架构偏离设计，避免引入未经审查的组件。
> 
> 建议：
> 1. 在白皮书中添加该功能的定义（包括类名、接口、性能要求）
> 2. 或者，如果该功能已存在但名称不同，请告诉我正确的名称
> 3. 或者，使用白皮书中已定义的类似功能"
```

**铁律2优化**:
```
强制执行：
- 如果用户要求"先写框架，后续再实现"，必须拒绝
- 如果代码太长，分多次提交，但每次提交的代码必须是完整的
- 不要说"实现细节类似"、"代码太长省略"等借口

如果用户要求使用占位符，回复模板：
> "根据MIA编码铁律2（禁止简化和占位符），我不能使用pass、TODO或任何占位符。所有代码必须有完整实现。
> 
> 如果代码较长，我可以：
> 1. 分多个文件实现，每个文件都是完整的
> 2. 先实现核心功能，后续再添加辅助功能
> 3. 使用更简洁的实现方式
> 
> 但无论如何，我提供的每一个函数都必须是完整可运行的。"
```

### 3. 新增"步骤0: 任务确认" 🔍

**位置**: 编码流程的第一步（在"步骤1: 阅读白皮书"之前）

**内容**:
```
在开始编码前，必须先确认：
1. 该功能在白皮书中有明确定义吗？（搜索类名、函数名）
2. 我理解的功能需求是否正确？
3. 是否有相关的实现检查项？
4. 性能要求是什么？

如果任何一个问题的答案不明确，立即向用户确认，不要猜测！
```

**优化理由**:
- 防止LLM在理解不清的情况下开始编码
- 强制LLM先确认需求，避免返工
- 明确"不要猜测"的原则

### 4. 新增"快速检查清单" ✅

**位置**: 文档末尾，总结部分之后

**内容**:
- 8个必查问题，每个都是yes/no问题
- 明确"如果任何一个答案是'否'，不要提交代码！"
- 提供可操作的检查点

**检查清单**:
```
- [ ] 我在白皮书中找到了这个类/函数的定义吗？
- [ ] 我的代码中有任何 pass、TODO、NotImplemented 吗？
- [ ] 所有函数都有完整的类型注解吗？
- [ ] 所有函数都有完整的docstring（包含白皮书依据）吗？
- [ ] 所有可能失败的操作都有错误处理吗？
- [ ] 我写了对应的单元测试吗？
- [ ] 测试覆盖率达到85%了吗？
- [ ] 我运行了幻觉检查脚本吗？
```

### 5. 新增"与用户沟通的原则" 💬

**位置**: 文档末尾

**内容**:
- 当用户要求违反铁律时的沟通原则
- 3个实际对话示例
- "当不确定时"的处理原则

**沟通原则**:
- **态度**：礼貌但坚定
- **方式**：解释原因，提供替代方案
- **底线**：不妥协质量标准

**示例对话1**:
```
用户："先写个框架，用TODO标记，后面再实现"
你："我理解您想快速看到结构，但根据MIA编码铁律2，我不能使用TODO或占位符。我可以先实现核心功能，确保代码完整可运行，然后再逐步添加其他功能。这样每次提交的代码都是可测试、可运行的。"
```

**示例对话2**:
```
用户："这个类在白皮书里没有，但我觉得需要"
你："我理解这个功能的价值，但根据MIA编码铁律1（白皮书至上），我不能实现未在白皮书中定义的功能。建议：1) 先在白皮书中添加该类的定义，包括接口、职责、性能要求；2) 或者使用白皮书中已定义的类似功能。这样可以确保系统架构的一致性。"
```

**示例对话3**:
```
用户："测试覆盖率70%够了吧？"
你："根据MIA编码铁律7，单元测试覆盖率必须≥85%。这不是任意的数字，而是工业级软件的质量标准。我会帮您补充测试用例，确保达到要求的覆盖率。"
```

**不确定时的原则**:
```
永远不要猜测！如果你不确定：
- 某个类是否在白皮书中定义
- 某个参数的正确类型
- 某个性能指标的具体数值

立即向用户确认，不要凭记忆或假设编码。

示例：
> "我在白皮书中搜索了'DataProcessor'，但没有找到明确的定义。您是指第三章的'DataSanitizer'吗？或者这是一个新的类需要先在白皮书中定义？"
```

---

## 📊 优化效果

### 优化前的问题

1. **缺乏强制性**: 铁律看起来像"建议"而不是"命令"
2. **缺乏拒绝指导**: LLM不知道如何礼貌地拒绝用户的不合理要求
3. **缺乏确认步骤**: LLM可能在理解不清的情况下开始编码
4. **缺乏检查清单**: LLM可能遗漏某些质量检查
5. **缺乏沟通指导**: LLM不知道如何与用户沟通质量标准

### 优化后的改进

1. ✅ **明确强制性**: "这些铁律是强制性的，不可协商的"
2. ✅ **提供拒绝模板**: 为每条铁律提供标准回复模板
3. ✅ **新增确认步骤**: "步骤0: 任务确认"
4. ✅ **提供检查清单**: 8个必查问题
5. ✅ **提供沟通指导**: 3个实际对话示例

### 验证结果

**评分**: 100.0/100 🎉

- ✅ 成功: 31项
- ⚠️ 警告: 0项
- ❌ 错误: 0项

---

## 🎯 预期效果

### 对LLM的影响

1. **更少的幻觉**: 明确的拒绝指令和检查步骤
2. **更高的质量**: 强制性的质量标准和检查清单
3. **更好的沟通**: 标准回复模板和对话示例
4. **更少的返工**: 任务确认步骤避免理解偏差

### 对用户的影响

1. **更清晰的反馈**: LLM会明确告知为什么拒绝某些要求
2. **更好的建议**: LLM会提供替代方案而不是简单拒绝
3. **更高的信心**: 知道LLM遵循严格的质量标准
4. **更少的bug**: 完整的实现和测试覆盖

---

## 📚 使用建议

### 对于Kiro AI

编码规则已自动加载，优化后的提示词会立即生效。你会发现：
- 我会更主动地检查白皮书
- 我会更坚定地拒绝不合理要求
- 我会更频繁地向你确认需求
- 我会提供更完整的代码实现

### 对于人类开发者

如果你使用其他LLM（如ChatGPT、Claude），建议：
1. 在每次对话开始时加载优化后的编码规则
2. 当LLM试图使用占位符时，引用铁律2
3. 当LLM创造新类名时，引用铁律1
4. 使用快速检查清单验证LLM的输出

---

## 🔄 持续改进

### 下一步优化方向

1. **添加更多对话示例**: 覆盖更多实际场景
2. **添加性能优化指导**: 如何达到性能要求
3. **添加调试指导**: 如何定位和修复问题
4. **添加重构指导**: 如何安全地重构代码

### 反馈收集

如果在使用过程中发现：
- LLM仍然产生幻觉
- LLM妥协了质量标准
- LLM的拒绝方式不够礼貌
- 缺少某些场景的指导

请记录下来，用于下一次优化。

---

## ✅ 总结

本次优化显著提高了编码规则的强制性和实用性：

1. **新增内容**:
   - ⚠️ 重要提示部分
   - 🚨 强制执行说明
   - 📋 拒绝回复模板
   - 🔍 步骤0: 任务确认
   - ✅ 快速检查清单
   - 💬 与用户沟通的原则

2. **优化效果**:
   - 更强的防幻觉能力
   - 更高的代码质量
   - 更好的用户体验
   - 更少的返工

3. **验证结果**:
   - 评分: 100.0/100 🎉
   - 所有检查通过

**MIA编码规则提示词系统已达到工业级标准，可以立即投入使用！** 🚀

---

**优化人**: Kiro AI Assistant  
**优化日期**: 2026-01-16  
**版本**: v1.4.9 (优化版)  
**状态**: ✅ 完成并验证通过
